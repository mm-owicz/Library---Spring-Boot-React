{"ast":null,"code":"import _slicedToArray from\"C:/Users/magma/Downloads/Lab 4/Lab-4/library-fe/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState}from'react';import auth from\"../data/Auth\";import AppBar from\"../components/AppBar\";import{useNavigate}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ReservedBooksPage=function ReservedBooksPage(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),books=_useState2[0],setBooks=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),message=_useState4[0],setMessage=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),error=_useState6[0],setError=_useState6[1];var username=auth.getUser()||\"\";var navigate=useNavigate();useEffect(function(){if(!auth.isAuthenticated()){navigate(\"/login\");}fetchReserved();},[]);var fetchReserved=function fetchReserved(){fetch(\"/book/reservations?user=\"+auth.getUser(),{method:\"GET\",headers:{'Content-Type':'application/json'}}).then(function(result){return result.json();}).then(function(books){return setBooks(books);});};var handleLeased=function handleLeased(bkId,ver){var bookAct={bookId:bkId,username:username,version:ver};fetch(\"/book/lease\",{method:\"PUT\",body:JSON.stringify(bookAct),headers:{'Content-Type':'application/json'}}).then(function(response){if(response.ok){setMessage(\"Książka pożyczona!\");}else if(response.status==409){setError(\"Książka już pożyczona!\");}});};var handleDel=function handleDel(bkId,ver){var bookAct={bookId:bkId,username:username,version:ver};fetch(\"/book/deleteRes\",{method:\"PUT\",body:JSON.stringify(bookAct),headers:{'Content-Type':'application/json'}}).then(function(response){if(response.ok){setMessage(\"Rezerwacja usunięta!\");}else if(response.status==409){setError(\"Rezerwacja już była usunięta!\");}});};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(AppBar,{}),/*#__PURE__*/_jsx(\"h1\",{children:\"Library - reserved books\"}),message!=\"\"?/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-success\",role:\"alert\",children:message}):null,error!=\"\"?/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-warning alert-dismissible fade show\",role:\"alert\",children:error}):null,/*#__PURE__*/_jsxs(\"table\",{className:\"table table-striped\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Book Title\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Book Author\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Publisher\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Reserved until\"}),auth.isLibrarian()?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"User\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Lease\"})]}):/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Cancel reservation\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:books.map(function(item,index){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:item.title}),/*#__PURE__*/_jsx(\"td\",{children:item.author}),/*#__PURE__*/_jsx(\"td\",{children:item.publisher}),/*#__PURE__*/_jsx(\"td\",{children:item.reserved}),auth.isLibrarian()?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"td\",{children:item.user}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"button\",{className:\"primary\",onClick:function onClick(){return handleLeased(item.bookId,item.version);},children:\"Mark Leased\"})})]}):/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"button\",{className:\"primary\",onClick:function onClick(){return handleDel(item.bookId,item.version);},children:\"Delete Reservation\"})})]});})})]})]});};export default ReservedBooksPage;","map":{"version":3,"names":["React","useEffect","useState","auth","AppBar","useNavigate","ReservedBooksPage","books","setBooks","message","setMessage","error","setError","username","getUser","navigate","isAuthenticated","fetchReserved","fetch","method","headers","then","result","json","handleLeased","bkId","ver","bookAct","bookId","version","body","JSON","stringify","response","ok","status","handleDel","isLibrarian","map","item","index","title","author","publisher","reserved","user"],"sources":["C:/Users/magma/Downloads/Lab 4/Lab-4/library-fe/src/pages/ReservedBooksPage.tsx"],"sourcesContent":["import React, {useEffect, useState} from 'react'\r\nimport {bookDTO} from \"../data/bookDTO\";\r\nimport auth from \"../data/Auth\";\r\nimport {bookActionDTO} from \"../data/bookActionDTO\";\r\nimport AppBar from \"../components/AppBar\";\r\nimport {useNavigate} from \"react-router-dom\";\r\n\r\n\r\nconst ReservedBooksPage = () => {\r\n    const [books, setBooks] = useState<bookDTO[]>([]);\r\n    const [message, setMessage] = useState(\"\");\r\n    const [error, setError] = useState(\"\");\r\n    let username = auth.getUser() || \"\";\r\n    const navigate = useNavigate();\r\n\r\n    useEffect( () => {\r\n        if(!auth.isAuthenticated()){\r\n            navigate(\"/login\");\r\n        }\r\n        fetchReserved();\r\n    }, [])\r\n\r\n    const fetchReserved = () => {\r\n        fetch(\"/book/reservations?user=\" + auth.getUser(),\r\n            {method: \"GET\", headers: {'Content-Type': 'application/json'}})\r\n            .then(result => result.json())\r\n            .then(books => setBooks(books));\r\n    }\r\n\r\n\r\n    const handleLeased = (bkId: number, ver: number) => {\r\n        const bookAct: bookActionDTO = {\r\n            bookId: bkId,\r\n            username: username,\r\n            version: ver\r\n        }\r\n\r\n        fetch(\"/book/lease\",\r\n            {method: \"PUT\", body: JSON.stringify(bookAct), headers: {'Content-Type': 'application/json'}})\r\n            .then(\r\n                response => {\r\n                    if(response.ok){\r\n                        setMessage(\"Książka pożyczona!\");\r\n                    }else if(response.status == 409){\r\n                        setError(\"Książka już pożyczona!\");\r\n                    }\r\n                }\r\n            )\r\n    }\r\n\r\n    const handleDel = (bkId: number, ver: number) => {\r\n        const bookAct: bookActionDTO = {\r\n            bookId: bkId,\r\n            username: username,\r\n            version: ver\r\n        }\r\n\r\n        fetch(\"/book/deleteRes\",\r\n            {method: \"PUT\", body: JSON.stringify(bookAct), headers: {'Content-Type': 'application/json'}})\r\n            .then(\r\n                response => {\r\n                    if(response.ok){\r\n                        setMessage(\"Rezerwacja usunięta!\");\r\n                    }else if(response.status == 409){\r\n                        setError(\"Rezerwacja już była usunięta!\");\r\n                    }\r\n                }\r\n            )\r\n    }\r\n\r\n    return(\r\n        <>\r\n            <AppBar />\r\n            <h1>Library - reserved books</h1>\r\n\r\n            {message != \"\" ?\r\n                <div className=\"alert alert-success\" role=\"alert\">\r\n                    {message}\r\n                </div> : null\r\n            }\r\n            {error != \"\" ?\r\n                <div className=\"alert alert-warning alert-dismissible fade show\" role=\"alert\">\r\n                    {error}\r\n                </div> : null\r\n            }\r\n\r\n\r\n            <table className=\"table table-striped\">\r\n                <thead>\r\n                <tr>\r\n                    <th scope=\"col\">Book Title</th>\r\n                    <th scope=\"col\">Book Author</th>\r\n                    <th scope=\"col\">Publisher</th>\r\n                    <th scope=\"col\">Reserved until</th>\r\n\r\n                    {auth.isLibrarian() ?\r\n                        <>\r\n                        <th scope=\"col\">User</th>\r\n                        <th scope=\"col\">Lease</th>\r\n                        </>\r\n                        :\r\n                        <th scope=\"col\">Cancel reservation</th>\r\n                    }\r\n\r\n                </tr>\r\n                </thead>\r\n                <tbody>\r\n\r\n                {books.map((item, index) =>\r\n                    <tr>\r\n                        <td>{item.title}</td>\r\n                        <td>{item.author}</td>\r\n                        <td>{item.publisher}</td>\r\n                        <td>{item.reserved}</td>\r\n\r\n                        {auth.isLibrarian() ?\r\n                            <>\r\n                            <td>{item.user}</td>\r\n                            <td>\r\n                                <button className=\"primary\"\r\n                                        onClick={() => handleLeased(item.bookId, item.version)}>Mark Leased</button>\r\n                            </td>\r\n                            </>\r\n                            :\r\n                            <td>\r\n                                <button className=\"primary\"\r\n                                        onClick={() => handleDel(item.bookId, item.version)}>Delete Reservation</button>\r\n                            </td>\r\n\r\n                        }\r\n                    </tr>)}\r\n\r\n                </tbody>\r\n            </table>\r\n\r\n        </>\r\n    )\r\n}\r\n\r\nexport default ReservedBooksPage"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}