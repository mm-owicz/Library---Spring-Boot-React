{"ast":null,"code":"import _slicedToArray from\"C:/Users/magma/Downloads/Lab 4/Lab-4/library-fe/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState}from'react';// import user from \"../dto/user\";\nimport auth from\"../data/Auth\";import AppBar from\"../components/AppBar\";import{useNavigate}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var LeasedBooksPage=function LeasedBooksPage(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),books=_useState2[0],setBooks=_useState2[1];var username=auth.getUser()||\"\";var navigate=useNavigate();var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),message=_useState4[0],setMessage=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),error=_useState6[0],setError=_useState6[1];useEffect(function(){if(!auth.isAuthenticated()){navigate(\"/login\");}fetchLeased();},[]);var fetchLeased=function fetchLeased(){fetch(\"/book/leases?user=\"+auth.getUser(),{method:\"GET\",headers:{'Content-Type':'application/json'}}).then(function(result){return result.json();}).then(function(books){return setBooks(books);});};var handleReturn=function handleReturn(bkId,ver){var bookAct={bookId:bkId,username:username,version:ver};fetch(\"/book/markReturned\",{method:\"PUT\",body:JSON.stringify(bookAct),headers:{'Content-Type':'application/json'}}).then(function(response){if(response.ok){setMessage(\"Książka oddana!\");}else if(response.status==409){setError(\"Książka już była oddana!\");}});};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(AppBar,{}),/*#__PURE__*/_jsx(\"h1\",{children:\"Library - leased books\"}),message!=\"\"?/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-success\",role:\"alert\",children:message}):null,error!=\"\"?/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-warning alert-dismissible fade show\",role:\"alert\",children:error}):null,/*#__PURE__*/_jsxs(\"table\",{className:\"table table-striped\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Book Title\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Book Author\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Publisher\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Date leased\"}),auth.isLibrarian()?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"User\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Mark returned\"})]}):null]})}),/*#__PURE__*/_jsx(\"tbody\",{children:books.map(function(item,index){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:item.title}),/*#__PURE__*/_jsx(\"td\",{children:item.author}),/*#__PURE__*/_jsx(\"td\",{children:item.publisher}),/*#__PURE__*/_jsx(\"td\",{children:item.leased}),auth.isLibrarian()?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"td\",{children:item.user}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"button\",{className:\"primary\",onClick:function onClick(){return handleReturn(item.bookId,item.version);},children:\"Mark returned\"})})]}):null]});})})]})]});};export default LeasedBooksPage;","map":{"version":3,"names":["React","useEffect","useState","auth","AppBar","useNavigate","LeasedBooksPage","books","setBooks","username","getUser","navigate","message","setMessage","error","setError","isAuthenticated","fetchLeased","fetch","method","headers","then","result","json","handleReturn","bkId","ver","bookAct","bookId","version","body","JSON","stringify","response","ok","status","isLibrarian","map","item","index","title","author","publisher","leased","user"],"sources":["C:/Users/magma/Downloads/Lab 4/Lab-4/library-fe/src/pages/LeasedBooksPage.tsx"],"sourcesContent":["import React, {useEffect, useState} from 'react'\r\n// import user from \"../dto/user\";\r\n import { bookDTO } from \"../data/bookDTO\";\r\nimport auth from \"../data/Auth\";\r\nimport {bookActionDTO} from \"../data/bookActionDTO\";\r\nimport AppBar from \"../components/AppBar\";\r\nimport {useNavigate} from \"react-router-dom\";\r\n\r\nconst LeasedBooksPage = () => {\r\n    const [books, setBooks] = useState<bookDTO[]>([]);\r\n    let username = auth.getUser() || \"\";\r\n    const navigate = useNavigate();\r\n    const [message, setMessage] = useState(\"\");\r\n    const [error, setError] = useState(\"\");\r\n\r\n\r\n    useEffect( () => {\r\n        if(!auth.isAuthenticated()){\r\n            navigate(\"/login\");\r\n        }\r\n        fetchLeased();\r\n    }, [])\r\n\r\n    const fetchLeased = () => {\r\n        fetch(\"/book/leases?user=\" + auth.getUser(),\r\n            {method: \"GET\", headers: {'Content-Type': 'application/json'}})\r\n            .then(result => result.json())\r\n            .then(books => setBooks(books));\r\n    }\r\n\r\n    const handleReturn = (bkId: number, ver: number) => {\r\n        const bookAct: bookActionDTO = {\r\n            bookId: bkId,\r\n            username: username,\r\n            version: ver\r\n        }\r\n\r\n        fetch(\"/book/markReturned\",\r\n            {method: \"PUT\", body: JSON.stringify(bookAct), headers: {'Content-Type': 'application/json'}})\r\n            .then(\r\n                response => {\r\n                    if(response.ok){\r\n                        setMessage(\"Książka oddana!\");\r\n                    }else if(response.status == 409){\r\n                        setError(\"Książka już była oddana!\");\r\n                    }\r\n                }\r\n            )\r\n    }\r\n\r\n\r\n    return(\r\n        <>\r\n            <AppBar />\r\n            <h1>Library - leased books</h1>\r\n\r\n            {message != \"\" ?\r\n                <div className=\"alert alert-success\" role=\"alert\">\r\n                    {message}\r\n                </div> : null\r\n            }\r\n            {error != \"\" ?\r\n                <div className=\"alert alert-warning alert-dismissible fade show\" role=\"alert\">\r\n                    {error}\r\n                </div> : null\r\n            }\r\n\r\n            <table className=\"table table-striped\">\r\n                <thead>\r\n                <tr>\r\n                    <th scope=\"col\">Book Title</th>\r\n                    <th scope=\"col\">Book Author</th>\r\n                    <th scope=\"col\">Publisher</th>\r\n                    <th scope=\"col\">Date leased</th>\r\n                    {auth.isLibrarian() ?\r\n                        <>\r\n                            <th scope=\"col\">User</th>\r\n                            <th scope=\"col\">Mark returned</th>\r\n                        </> : null\r\n                    }\r\n                </tr>\r\n                </thead>\r\n\r\n                <tbody>\r\n                {books.map((item, index) =>\r\n                    <tr>\r\n                        <td>{item.title}</td>\r\n                        <td>{item.author}</td>\r\n                        <td>{item.publisher}</td>\r\n                        <td>{item.leased}</td>\r\n                        {auth.isLibrarian() ?\r\n                            <>\r\n                                <td>{item.user}</td>\r\n                                <td>\r\n                                    <button className=\"primary\"\r\n                                            onClick={() => handleReturn(item.bookId, item.version)}>Mark returned</button>\r\n                                </td>\r\n                            </> : null\r\n                        }\r\n                    </tr>\r\n                )}\r\n\r\n                </tbody>\r\n            </table>\r\n        </>\r\n\r\n\r\n    )\r\n}\r\n\r\nexport default LeasedBooksPage"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}