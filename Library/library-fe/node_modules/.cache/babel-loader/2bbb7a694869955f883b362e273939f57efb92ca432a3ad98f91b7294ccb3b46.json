{"ast":null,"code":"import _slicedToArray from\"C:/Users/magma/Downloads/Lab 4/Lab-4/library-fe/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState}from'react';import'bootstrap/dist/css/bootstrap.css';import auth from\"../data/Auth\";import AppBar from\"../components/AppBar\";import{useNavigate}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var SearchBooksPage=function SearchBooksPage(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),books=_useState2[0],setBooks=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),searchString=_useState4[0],setSearchString=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),message=_useState6[0],setMessage=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),error=_useState8[0],setError=_useState8[1];var username=auth.getUser()||\"\";var navigate=useNavigate();useEffect(function(){console.log(searchString);if(!auth.isAuthenticated()){navigate(\"/login\");}fetchBooks();},[]);useEffect(function(){fetchBooks();},[searchString]);var fetchBooks=function fetchBooks(){fetch('/book/search?s='+searchString).then(function(result){return result.json();}).then(function(books){return setBooks(books);});};var handleReserve=function handleReserve(bkId,ver){var bookAct={bookId:bkId,username:username,version:ver};fetch(\"/book/reserve\",{method:\"PUT\",body:JSON.stringify(bookAct),headers:{'Content-Type':'application/json'}}).then(function(response){if(response.ok){setMessage(\"Książka zarezerwowana!\");}else if(response.status==409){setError(\"Książka niedostępna!\");}});};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(AppBar,{}),/*#__PURE__*/_jsx(\"h1\",{children:\"Library - search books\"}),message!=\"\"?/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-success\",role:\"alert\",children:message}):null,error!=\"\"?/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-warning alert-dismissible fade show\",role:\"alert\",children:error}):null,/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"input-group\",children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"searchString\",id:\"searchString\",className:\"form-control\",placeholder:\"Search\",\"aria-label\":\"Search\",onInput:function onInput(event){return setSearchString(event.currentTarget.value);}})}),/*#__PURE__*/_jsxs(\"table\",{className:\"table table-striped table-hover\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Book Title\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Book Author\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Publisher\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Publish date\"}),!auth.isLibrarian()&&/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Reserve\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:books.map(function(item,index){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:item.title}),/*#__PURE__*/_jsx(\"td\",{children:item.author}),/*#__PURE__*/_jsx(\"td\",{children:item.publisher}),/*#__PURE__*/_jsx(\"td\",{children:item.date}),!auth.isLibrarian()&&/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"button\",{className:\"primary\",onClick:function onClick(){return handleReserve(item.bookId,item.version);},children:\"Reserve\"})})]});})})]})]})]});};export default SearchBooksPage;","map":{"version":3,"names":["React","useEffect","useState","auth","AppBar","useNavigate","SearchBooksPage","books","setBooks","searchString","setSearchString","message","setMessage","error","setError","username","getUser","navigate","console","log","isAuthenticated","fetchBooks","fetch","then","result","json","handleReserve","bkId","ver","bookAct","bookId","version","method","body","JSON","stringify","headers","response","ok","status","event","currentTarget","value","isLibrarian","map","item","index","title","author","publisher","date"],"sources":["C:/Users/magma/Downloads/Lab 4/Lab-4/library-fe/src/pages/SearchBooksPage.tsx"],"sourcesContent":["import React, {useEffect, useState} from 'react'\r\nimport 'bootstrap/dist/css/bootstrap.css';\r\nimport {bookDTO} from \"../data/bookDTO\";\r\nimport auth from \"../data/Auth\";\r\nimport {bookActionDTO} from \"../data/bookActionDTO\";\r\nimport AppBar from \"../components/AppBar\";\r\nimport {useNavigate} from \"react-router-dom\";\r\n\r\n\r\nconst SearchBooksPage = () => {\r\n    const [books, setBooks] = useState<bookDTO[]>([]);\r\n    const [searchString, setSearchString] = useState(\"\");\r\n    const [message, setMessage] = useState(\"\");\r\n    const [error, setError] = useState(\"\");\r\n    let username = auth.getUser() || \"\";\r\n    const navigate = useNavigate();\r\n\r\n    useEffect( () => {\r\n        console.log(searchString)\r\n        if(!auth.isAuthenticated()){\r\n            navigate(\"/login\");\r\n        }\r\n        fetchBooks();\r\n    }, [])\r\n\r\n    useEffect( () => {\r\n        fetchBooks();\r\n    }, [searchString])\r\n\r\n    const fetchBooks = () => {\r\n        fetch('/book/search?s='+searchString)\r\n            .then(result => result.json())\r\n            .then(books => setBooks(books));\r\n    }\r\n\r\n    const handleReserve = (bkId: number, ver: number) =>{\r\n        const bookAct: bookActionDTO = {\r\n            bookId: bkId,\r\n            username: username,\r\n            version: ver\r\n        }\r\n        fetch(\"/book/reserve\",\r\n            {method: \"PUT\", body: JSON.stringify(bookAct), headers: {'Content-Type': 'application/json'}})\r\n            .then(\r\n                response => {\r\n                    if(response.ok){\r\n                        setMessage(\"Książka zarezerwowana!\");\r\n                    }else if(response.status == 409){\r\n                        setError(\"Książka niedostępna!\");\r\n                    }\r\n                }\r\n            )\r\n    }\r\n\r\n    return(\r\n        <>\r\n\r\n            <AppBar />\r\n            <h1>Library - search books</h1>\r\n\r\n            {message != \"\" ?\r\n                <div className=\"alert alert-success\" role=\"alert\">\r\n                    {message}\r\n                </div> : null\r\n            }\r\n            {error != \"\" ?\r\n                <div className=\"alert alert-warning alert-dismissible fade show\" role=\"alert\">\r\n                    {error}\r\n                </div> : null\r\n            }\r\n\r\n            <div>\r\n\r\n                <div className=\"input-group\">\r\n                    <input type=\"text\" name=\"searchString\" id=\"searchString\" className=\"form-control\" placeholder=\"Search\"\r\n                           aria-label=\"Search\"\r\n                           onInput={event => setSearchString(event.currentTarget.value)}/>\r\n                </div>\r\n\r\n\r\n                <table className=\"table table-striped table-hover\">\r\n                    <thead>\r\n                    <tr>\r\n                        <th scope=\"col\">Book Title</th>\r\n                        <th scope=\"col\">Book Author</th>\r\n                        <th scope=\"col\">Publisher</th>\r\n                        <th scope=\"col\">Publish date</th>\r\n                        {!auth.isLibrarian() &&\r\n                        <th scope=\"col\">Reserve</th>\r\n                        }\r\n                    </tr>\r\n                    </thead>\r\n\r\n                    <tbody>\r\n\r\n                    {books.map((item, index) =>\r\n                        <tr>\r\n                            <td>{item.title}</td>\r\n                            <td>{item.author}</td>\r\n                            <td>{item.publisher}</td>\r\n                            <td>{item.date}</td>\r\n                            {!auth.isLibrarian() &&\r\n                            <td>\r\n                                <button className=\"primary\"\r\n                                        onClick={() => handleReserve(item.bookId, item.version)}>Reserve</button>\r\n                            </td>\r\n                            }\r\n                        </tr>\r\n                    )}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        </>\r\n\r\n    )\r\n}\r\n\r\nexport default SearchBooksPage"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}